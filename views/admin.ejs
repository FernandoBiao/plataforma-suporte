<!DOCTYPE html>
<html lang="pt-br">
<head><meta charset="UTF-8"/><title>Admin - Meus Chamados</title></head>
<body>
  <h1>Olá, <%= usuario.nome %> | <a href="/logout">Sair</a></h1>
  <a href="/cadastro-usuario">Cadastrar Usuário</a>
  <h2>Meus Chamados</h2>
  <table>
    <thead><tr><th>ID</th><th>Data</th><th>Assunto</th><th>Status</th><th>Atualizar</th></tr></thead>
    <tbody>
      <% chamados.forEach(c => { %>
        <tr>
          <td><%= c.id %></td>
          <td><%= c.dataCriacao %></td>
          <td><%= c.assunto %> / <%= c.subAssunto %></td>
          <td><%= c.status %></td>
          <td>
            <form method="POST" action="/atualizar-status">
              <input type="hidden" name="id" value="<%= c.id %>"/>
              <select name="status" required>
                <option value="Aberto" <%= c.status==='Aberto'? 'selected':'' %>>Aberto</option>
                <option value="Em análise" <%= c.status==='Em análise'? 'selected':'' %>>Em análise</option>
                <option value="Em espera" <%= c.status==='Em espera'? 'selected':'' %>>Em espera</option>
                <option value="Concluído" <%= c.status==='Concluído'? 'selected':'' %>>Concluído</option>
              </select>
              <textarea name="descricaoAtualizacao" placeholder="Descrição"></textarea>
              <button type="submit">Atualizar</button>
            </form>
            <% if (c.historico && c.historico.length) { %>
              <details><summary>Histórico</summary>
                <ul>
                  <% c.historico.forEach(h => { %>
                    <li><strong><%= h.data %></strong> → <%= h.status %> / <%= h.descricao || 'Sem descrição' %></li>
                  <% }) %>
                </ul>
              </details>
            <% } %>
          </td>
        </tr>
      <% }) %>
    </tbody>
  </table>
</body>
</html>
